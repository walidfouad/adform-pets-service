{"version":3,"sources":["../../src/data/dbmanager.js"],"names":["dbDirectory","path","join","appRoot","DBManager","modelTypes","Promise","resolve","reject","length","Error","result","forEach","modelType","modelData","loadModelFile","toLowerCase","concat","inputData","type","id","newModel","push","writeModelFile","modelId","oldModelIndex","_","findIndex","dogs","getDogs","cats","getCats","pets","modelFilePath","fs","existsSync","modelBuffer","readFileSync","JSON","parse","writeFileSync","stringify"],"mappings":"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","file":"dbmanager.js","sourcesContent":["import appRoot from 'app-root-path';\r\nimport uuidv4 from 'uuid/v4';\r\nimport path from 'path';\r\nimport _ from 'lodash';\r\nimport fs from 'fs';\r\n\r\nimport formatData, { formatDataRow } from './dataformat';\r\n\r\nconst dbDirectory = path.join(appRoot.path, 'json_data');\r\n\r\nexport default class DBManager {\r\n\r\n    constructor() {}\r\n\r\n    readModels(modelTypes) {\r\n        return new Promise((resolve, reject) => {\r\n            if (!modelTypes || modelTypes.length === 0) {\r\n                return reject(new Error('No modelType provided.'));\r\n            }\r\n            let result = [];\r\n            modelTypes.forEach((modelType) => {\r\n                if (modelType && modelType !== '') {\r\n                    const modelData = this.loadModelFile(modelType.toLowerCase());\r\n                    result = result.length === 0 ? result = modelData : result.concat(modelData);\r\n                }\r\n            });\r\n\r\n            resolve(result);\r\n        });\r\n\r\n    }\r\n\r\n    createNewModel(inputData) {\r\n        return new Promise((resolve, reject) => {\r\n            const modelType = inputData.type.toLowerCase();\r\n            const id = uuidv4();\r\n            inputData.id = id;\r\n\r\n            const newModel = formatDataRow(inputData);\r\n\r\n            let modelData = this.loadModelFile(modelType);\r\n\r\n            // Now insert the new record into modelData array\r\n            modelData.push(newModel);\r\n\r\n            // here write to model file in json db directory\r\n            this.writeModelFile(modelType, modelData);\r\n\r\n            resolve(newModel);\r\n        });\r\n    }\r\n\r\n    updateModel(modelId, inputData) {\r\n        return new Promise((resolve, reject) => {\r\n            const modelType = inputData.type.toLowerCase();\r\n\r\n            inputData.id = modelId;\r\n\r\n            const newModel = formatDataRow(inputData);\r\n\r\n            let modelData = this.loadModelFile(modelType);\r\n\r\n            const oldModelIndex = _.findIndex(modelData, { id: modelId });\r\n            // Now insert the new record into modelData array\r\n            modelData[oldModelIndex] = newModel;\r\n\r\n            // here write to model file in json db directory\r\n            this.writeModelFile(modelType, modelData);\r\n\r\n            resolve(newModel);\r\n        });\r\n    }\r\n\r\n\r\n    getOwners() {\r\n        return this.loadModelFile('OWNER');\r\n    }\r\n\r\n    getDogs() {\r\n        return this.loadModelFile('DOG');\r\n    }\r\n\r\n    getCats() {\r\n        return this.loadModelFile('CAT');\r\n    }\r\n\r\n    getPets() {\r\n        const dogs = this.getDogs();\r\n        const cats = this.getCats();\r\n        let pets = [];\r\n        pets = dogs.concat(cats);\r\n\r\n        return pets;\r\n    }\r\n\r\n    loadModelFile(modelType) {\r\n\r\n        const modelFilePath = path.join(dbDirectory, modelType) + '.json';\r\n        if (!fs.existsSync(modelFilePath)) {\r\n            return [];\r\n        }\r\n\r\n        const modelBuffer = fs.readFileSync(modelFilePath);\r\n\r\n        const modelData = (modelBuffer && modelBuffer.length > 0) ? JSON.parse(modelBuffer) : [];\r\n\r\n        return modelData;\r\n    }\r\n\r\n    writeModelFile(modelType, modelData) {\r\n        const modelFilePath = path.join(dbDirectory, modelType) + '.json';\r\n        fs.writeFileSync(modelFilePath, JSON.stringify(modelData));\r\n    }\r\n}"]}